<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Website Builder Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: '#0f172a',
                        darker: '#020617',
                        panel: '#1e293b',
                        border: '#334155',
                        primary: '#3b82f6',
                        accent: '#22c55e'
                    },
                    fontFamily: {
                        mono: ['"Fira Code"', 'Menlo', 'Monaco', 'Courier New', 'monospace']
                    }
                }
            }
        }
    </script>

    <style>
        /* CRITICAL: Mobile Viewport Fix */
        body {
            min-height: 100dvh;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background-color: #0f172a;
            color: #e2e8f0;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Loader */
        .loader {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 0.8s ease-in-out infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Mobile Sidebar Transition */
        #sidebar { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .sidebar-open { transform: translateX(0) !important; }
        .sidebar-closed { transform: translateX(-100%); }
        @media (min-width: 768px) { .sidebar-closed { transform: translateX(0); } }

        /* Editor Styling */
        #code-editor {
            font-family: 'Fira Code', 'Menlo', monospace;
            line-height: 1.5;
            tab-size: 4;
            caret-color: #3b82f6;
        }
    </style>
</head>
<body class="text-sm selection:bg-blue-500/30">

    <div class="flex flex-1 h-full overflow-hidden relative">
        
        <div id="mobile-backdrop" onclick="app.toggleSidebar()" class="fixed inset-0 bg-black/60 z-20 hidden md:hidden backdrop-blur-sm transition-opacity"></div>

        <aside id="sidebar" class="fixed md:relative z-30 w-72 h-full bg-darker border-r border-border flex flex-col sidebar-closed md:transform-none shadow-2xl md:shadow-none">
            <div class="p-4 border-b border-border flex items-center justify-between">
                <div class="flex items-center gap-2 font-bold text-lg text-white">
                    <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-code"></i>
                    </div>
                    <span>AI Builder</span>
                </div>
                <button onclick="app.toggleSidebar()" class="md:hidden text-slate-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="p-4">
                <button onclick="app.resetChat()" class="w-full bg-primary hover:bg-blue-600 text-white font-semibold py-2.5 px-4 rounded-lg transition-all shadow-lg shadow-blue-900/20 flex items-center justify-center gap-2 group">
                    <i class="fas fa-plus group-hover:rotate-90 transition-transform"></i> New Project
                </button>
            </div>

            <div class="flex-1 overflow-y-auto px-2 space-y-1" id="project-list">
                </div>

            <div class="p-4 border-t border-border bg-darker">
                <button onclick="app.toggleSettings()" class="w-full flex items-center gap-3 px-3 py-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-lg transition-colors">
                    <i class="fas fa-cog text-lg"></i>
                    <div class="flex flex-col items-start">
                        <span class="font-medium">Settings</span>
                        <span class="text-[10px] uppercase tracking-wider opacity-60">Config & Keys</span>
                    </div>
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col min-w-0 bg-panel relative">
            
            <header class="h-14 bg-dark border-b border-border flex items-center justify-between px-4 shrink-0 shadow-sm">
                
                <div class="flex items-center gap-4">
                    <button onclick="app.toggleSidebar()" class="md:hidden text-slate-400 hover:text-white p-2">
                        <i class="fas fa-bars text-lg"></i>
                    </button>

                    <div class="hidden sm:flex gap-2 opacity-80 hover:opacity-100 transition-opacity">
                        <div class="w-3 h-3 rounded-full bg-[#ff5f56] border border-[#e0443e]"></div>
                        <div class="w-3 h-3 rounded-full bg-[#ffbd2e] border border-[#dea123]"></div>
                        <div class="w-3 h-3 rounded-full bg-[#27c93f] border border-[#1aab29]"></div>
                    </div>
                </div>

                <div class="flex bg-black/20 rounded-lg p-1 border border-white/5">
                    <button id="btn-preview" onclick="app.switchView('preview')" class="px-4 py-1.5 rounded-md text-xs font-medium transition-all shadow-sm bg-primary text-white">
                        <i class="fas fa-desktop mr-1"></i> Preview
                    </button>
                    <button id="btn-code" onclick="app.switchView('code')" class="px-4 py-1.5 rounded-md text-xs font-medium transition-all text-slate-400 hover:text-white">
                        <i class="fas fa-code mr-1"></i> Code
                    </button>
                </div>

                <div class="flex items-center gap-2">
                    <button onclick="app.copyCode()" class="hidden sm:flex items-center gap-2 text-slate-400 hover:text-white px-3 py-1.5 rounded hover:bg-white/5 transition-colors text-xs font-medium">
                        <i class="far fa-copy"></i> Copy
                    </button>
                    <button onclick="app.downloadCode()" class="flex items-center gap-2 text-slate-400 hover:text-primary px-3 py-1.5 rounded hover:bg-white/5 transition-colors text-xs font-medium">
                        <i class="fas fa-download"></i> <span class="hidden sm:inline">Export</span>
                    </button>
                </div>
            </header>

            <div class="flex-1 relative overflow-hidden bg-white/5">
                
                <iframe id="preview-frame" class="w-full h-full border-0 bg-white" sandbox="allow-scripts allow-modals allow-forms"></iframe>
                
                <textarea id="code-editor" class="w-full h-full bg-[#1e1e1e] text-[#d4d4d4] p-4 resize-none border-0 focus:outline-none hidden font-mono text-sm leading-6" spellcheck="false" autocorrect="off" autocapitalize="off"></textarea>
                
                <div id="loading-overlay" class="absolute inset-0 bg-dark/90 backdrop-blur-sm flex items-center justify-center hidden z-50 transition-opacity duration-300">
                    <div class="text-center space-y-4">
                        <div class="loader mx-auto"></div>
                        <p class="text-blue-400 font-mono text-sm animate-pulse" id="loading-text">Initializing AI...</p>
                    </div>
                </div>

                <div id="empty-state" class="absolute inset-0 flex flex-col items-center justify-center text-slate-500 pointer-events-none p-6 text-center">
                    <div class="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-magic text-3xl opacity-50"></i>
                    </div>
                    <h3 class="text-lg font-medium text-slate-300">Start Building</h3>
                    <p class="text-sm max-w-xs mt-2">Describe your website below to generate code instantly.</p>
                </div>
            </div>

            <footer class="bg-dark border-t border-border p-3 md:p-5 shrink-0 z-20">
                <div class="max-w-4xl mx-auto relative">
                    <textarea 
                        id="user-input" 
                        rows="1"
                        placeholder="Describe your website (e.g. 'A modern landing page for a coffee shop with a hero section')..." 
                        class="w-full bg-panel text-white border border-border rounded-xl pl-4 pr-12 py-3.5 focus:ring-2 focus:ring-primary/50 focus:border-primary resize-none shadow-lg transition-all"
                        style="min-height: 52px; max-height: 150px;"
                        oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"
                        onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); app.generate(); }"
                    ></textarea>
                    
                    <button onclick="app.generate()" id="send-btn" class="absolute right-2 bottom-2.5 bg-primary hover:bg-blue-600 text-white w-9 h-9 rounded-lg flex items-center justify-center transition-all shadow-lg active:scale-95">
                        <i class="fas fa-paper-plane text-xs"></i>
                    </button>
                </div>
            </footer>
        </main>
    </div>

    <dialog id="settings-modal" class="bg-panel text-white rounded-xl shadow-2xl p-0 w-full max-w-md backdrop:bg-black/70 border border-border m-auto animate-fade-in">
        <div class="flex justify-between items-center p-5 border-b border-border bg-darker/50">
            <h2 class="text-lg font-bold flex items-center gap-2">
                <i class="fas fa-sliders-h text-primary"></i> Configuration
            </h2>
            <button onclick="document.getElementById('settings-modal').close()" class="text-slate-400 hover:text-white transition-colors w-8 h-8 rounded-full hover:bg-white/10 flex items-center justify-center">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="p-6 space-y-5">
            <div class="space-y-2">
                <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">API Endpoint</label>
                <div class="relative">
                    <i class="fas fa-link absolute left-3 top-3 text-slate-500"></i>
                    <input type="text" id="setting-url" class="w-full bg-dark border border-border rounded-lg py-2.5 pl-10 pr-3 focus:border-primary focus:ring-1 focus:ring-primary outline-none text-slate-200 text-sm font-mono" value="https://openrouter.ai/api/v1/chat/completions">
                </div>
            </div>

            <div class="space-y-2">
                <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">API Key</label>
                <div class="relative">
                    <i class="fas fa-key absolute left-3 top-3 text-slate-500"></i>
                    <input type="password" id="setting-key" placeholder="sk-or-..." class="w-full bg-dark border border-border rounded-lg py-2.5 pl-10 pr-3 focus:border-primary focus:ring-1 focus:ring-primary outline-none text-slate-200 text-sm font-mono">
                </div>
                <p class="text-[10px] text-slate-500">Keys are stored locally in your browser.</p>
            </div>

            <div class="space-y-2">
                <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">Model ID</label>
                <div class="relative">
                    <i class="fas fa-microchip absolute left-3 top-3 text-slate-500"></i>
                    <input type="text" id="setting-model" class="w-full bg-dark border border-border rounded-lg py-2.5 pl-10 pr-3 focus:border-primary focus:ring-1 focus:ring-primary outline-none text-slate-200 text-sm font-mono">
                </div>
            </div>
        </div>

        <div class="p-5 border-t border-border bg-darker/50 flex justify-end gap-3">
            <button onclick="app.clearData()" class="text-red-400 hover:text-red-300 text-xs font-medium px-3 py-2">Clear Data</button>
            <button onclick="app.saveSettings()" class="bg-primary hover:bg-blue-600 text-white px-5 py-2 rounded-lg font-medium shadow-lg shadow-blue-900/20 transition-all active:scale-95">Save Changes</button>
        </div>
    </dialog>

    <script>
        // System Prompt optimized for single-file output
        const SYSTEM_PROMPT = `You are an expert Frontend Engineer. 
        Your task: Generate a complete, single-file HTML website using Tailwind CSS (via CDN).
        
        STRICT RULES:
        1. Output ONLY valid HTML code. Start with <!DOCTYPE html>.
        2. Include <script src="https://cdn.tailwindcss.com"><\/script> in <head>.
        3. Use FontAwesome for icons: <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        4. Make it fully responsive (mobile-first).
        5. Do NOT include markdown backticks like \`\`\`html.
        6. Do NOT include explanations. Just the code.
        7. If updating code, return the FULL updated file, not just snippets.`;

        const app = {
            state: {
                projects: [],
                currentProject: null,
                settings: {
                    // FORCE OpenRouter URL
                    url: "https://openrouter.ai/api/v1/chat/completions",
                    key: "",
                    model: "deepseek/deepseek-r1:free"
                }
            },

            init() {
                this.loadSettings();
                this.loadProjects();
                this.setupDefaults();
                this.setupEditor();
                
                // Load latest project or reset
                if (this.state.projects.length > 0) {
                    this.loadProject(this.state.projects[0].id);
                } else {
                    this.resetChat();
                }

                // Initial UI Sync
                if (!this.state.settings.key) {
                    setTimeout(() => this.toggleSettings(), 500);
                }
            },

            // --- Storage & Settings ---

            loadSettings() {
                const saved = localStorage.getItem('aibuilder_settings');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        // Merge with defaults to ensure URL is always correct
                        this.state.settings = { ...this.state.settings, ...parsed, url: "https://openrouter.ai/api/v1/chat/completions" };
                    } catch (e) { console.error("Settings load error", e); }
                }
            },

            loadProjects() {
                const saved = localStorage.getItem('aibuilder_projects');
                if (saved) {
                    try {
                        this.state.projects = JSON.parse(saved);
                    } catch (e) { console.error("Project load error", e); }
                }
            },

            setupDefaults() {
                document.getElementById('setting-url').value = this.state.settings.url;
                document.getElementById('setting-key').value = this.state.settings.key;
                document.getElementById('setting-model').value = this.state.settings.model;
            },

            saveSettings() {
                const url = document.getElementById('setting-url').value.trim();
                const key = document.getElementById('setting-key').value.trim();
                const model = document.getElementById('setting-model').value.trim();

                // Validation
                if(url !== "https://openrouter.ai/api/v1/chat/completions") {
                    alert("Note: URL reset to OpenRouter default for compatibility.");
                }

                this.state.settings = { 
                    url: "https://openrouter.ai/api/v1/chat/completions", 
                    key, 
                    model 
                };
                
                localStorage.setItem('aibuilder_settings', JSON.stringify(this.state.settings));
                document.getElementById('settings-modal').close();
                
                // Visual feedback
                const btn = document.querySelector('button[onclick="app.toggleSettings()"]');
                btn.classList.add('text-green-400');
                setTimeout(() => btn.classList.remove('text-green-400'), 1000);
            },

            clearData() {
                if(confirm("Are you sure? This deletes all projects and keys locally.")) {
                    localStorage.clear();
                    location.reload();
                }
            },

            // --- UI Interaction ---

            toggleSettings() {
                this.setupDefaults();
                document.getElementById('settings-modal').showModal();
            },

            toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                const backdrop = document.getElementById('mobile-backdrop');
                
                if (sidebar.classList.contains('sidebar-closed')) {
                    sidebar.classList.remove('sidebar-closed');
                    sidebar.classList.add('sidebar-open');
                    backdrop.classList.remove('hidden');
                } else {
                    sidebar.classList.add('sidebar-closed');
                    sidebar.classList.remove('sidebar-open');
                    backdrop.classList.add('hidden');
                }
            },

            switchView(mode) {
                const pBtn = document.getElementById('btn-preview');
                const cBtn = document.getElementById('btn-code');
                const frame = document.getElementById('preview-frame');
                const editor = document.getElementById('code-editor');
                const empty = document.getElementById('empty-state');

                // Update data if switching from code to preview
                if (mode === 'preview' && !editor.classList.contains('hidden')) {
                    this.updatePreview(editor.value, false); // false = don't update editor value again
                }

                if (mode === 'preview') {
                    pBtn.className = "px-4 py-1.5 rounded-md text-xs font-medium transition-all shadow-sm bg-primary text-white";
                    cBtn.className = "px-4 py-1.5 rounded-md text-xs font-medium transition-all text-slate-400 hover:text-white";
                    
                    frame.classList.remove('hidden');
                    editor.classList.add('hidden');
                    if(!editor.value) empty.classList.remove('hidden');
                } else {
                    cBtn.className = "px-4 py-1.5 rounded-md text-xs font-medium transition-all shadow-sm bg-primary text-white";
                    pBtn.className = "px-4 py-1.5 rounded-md text-xs font-medium transition-all text-slate-400 hover:text-white";

                    frame.classList.add('hidden');
                    editor.classList.remove('hidden');
                    empty.classList.add('hidden');
                }
            },

            setupEditor() {
                const textarea = document.getElementById('code-editor');
                // Tab support
                textarea.addEventListener('keydown', function(e) {
                    if (e.key == 'Tab') {
                        e.preventDefault();
                        var start = this.selectionStart;
                        var end = this.selectionEnd;
                        // set textarea value to: text before caret + tab + text after caret
                        this.value = this.value.substring(0, start) + "\t" + this.value.substring(end);
                        // put caret at right position again
                        this.selectionStart = this.selectionEnd = start + 1;
                    }
                });
            },

            // --- Core Logic ---

            resetChat() {
                this.state.currentProject = null;
                document.getElementById('preview-frame').srcdoc = "";
                document.getElementById('code-editor').value = "";
                document.getElementById('user-input').value = "";
                document.getElementById('empty-state').classList.remove('hidden');
                this.renderProjects();
                
                // Auto close sidebar on mobile
                if(window.innerWidth < 768) this.toggleSidebar();
                
                document.getElementById('user-input').focus();
            },

            updatePreview(html, updateEditor = true) {
                // 1. Sanitize Markdown & Think tags
                let clean = html
                    .replace(/```html/g, '')
                    .replace(/```/g, '')
                    .replace(/<think>[\s\S]*?<\/think>/gi, '') // Remove deepseek reasoning
                    .trim();

                const frame = document.getElementById('preview-frame');
                const empty = document.getElementById('empty-state');

                // 2. Inject
                frame.srcdoc = clean;
                if (updateEditor) document.getElementById('code-editor').value = clean;
                
                // 3. UI State
                empty.classList.add('hidden');
            },

            async generate() {
                const inputEl = document.getElementById('user-input');
                const prompt = inputEl.value.trim();
                const loader = document.getElementById('loading-overlay');
                const loadText = document.getElementById('loading-text');

                if (!prompt) return;
                
                if (!this.state.settings.key) {
                    alert("Please set your API Key in Settings first.");
                    this.toggleSettings();
                    return;
                }

                // UI Loading
                loader.classList.remove('hidden');
                loadText.innerText = "Generating Code...";
                inputEl.disabled = true;

                try {
                    const messages = [
                        { role: "system", content: SYSTEM_PROMPT },
                        { role: "user", content: prompt }
                    ];

                    // Include history if editing existing project
                    const currentCode = document.getElementById('code-editor').value;
                    if (this.state.currentProject && currentCode.trim()) {
                        messages.splice(1, 0, { role: "assistant", content: currentCode });
                        messages[2] = { role: "user", content: `UPDATE the code above based on this request: ${prompt}` };
                        loadText.innerText = "Refining Website...";
                    }

                    // --- CRITICAL FETCH LOGIC START ---
                    const response = await fetch(this.state.settings.url, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${this.state.settings.key}`,
                            "HTTP-Referer": window.location.href,
                            "X-Title": "AI Website Builder Pro"
                        },
                        body: JSON.stringify({
                            model: this.state.settings.model,
                            messages: messages,
                            temperature: 0.7
                        })
                    });

                    // 1. Get raw text first (Anti-Crash)
                    const rawText = await response.text();

                    // 2. Check HTTP status
                    if (!response.ok) {
                        let errMsg = rawText;
                        try {
                            const errJson = JSON.parse(rawText);
                            errMsg = errJson.error?.message || rawText;
                        } catch(e) {}
                        
                        alert(`API Error (${response.status}): ${errMsg}`);
                        throw new Error("API Request Failed");
                    }

                    // 3. Parse JSON safely
                    let json;
                    try {
                        json = JSON.parse(rawText);
                    } catch (e) {
                        alert("Error parsing AI response. See console.");
                        console.error("Raw response:", rawText);
                        throw new Error("Invalid JSON");
                    }
                    // --- CRITICAL FETCH LOGIC END ---

                    if (!json.choices?.[0]?.message?.content) {
                        throw new Error("Unexpected API format");
                    }

                    const content = json.choices[0].message.content;
                    
                    this.updatePreview(content);
                    this.saveProject(prompt, content);
                    this.switchView('preview'); // Ensure we see result
                    
                    inputEl.value = ""; // Clear input
                    inputEl.style.height = 'auto'; // Reset height

                } catch (err) {
                    console.error(err);
                } finally {
                    loader.classList.add('hidden');
                    inputEl.disabled = false;
                    inputEl.focus();
                }
            },

            saveProject(name, code) {
                // Sanitize name
                let cleanName = name.replace(/\n/g, ' ').substring(0, 30);
                if (name.length > 30) cleanName += "...";
                
                const now = new Date();

                if (this.state.currentProject) {
                    // Update existing
                    this.state.currentProject.code = code;
                    this.state.currentProject.updated = now.toISOString();
                    // Move to top
                    this.state.projects = this.state.projects.filter(p => p.id !== this.state.currentProject.id);
                    this.state.projects.unshift(this.state.currentProject);
                } else {
                    // Create new
                    const newProj = {
                        id: Date.now().toString(),
                        name: cleanName || "Untitled Project",
                        code: code,
                        created: now.toISOString(),
                        updated: now.toISOString()
                    };
                    this.state.projects.unshift(newProj);
                    this.state.currentProject = newProj;
                }

                localStorage.setItem('aibuilder_projects', JSON.stringify(this.state.projects));
                this.renderProjects();
            },

            deleteProject(id, event) {
                event.stopPropagation(); // Prevent loading the project
                if(!confirm("Delete this project?")) return;

                this.state.projects = this.state.projects.filter(p => p.id !== id);
                localStorage.setItem('aibuilder_projects', JSON.stringify(this.state.projects));
                
                if (this.state.currentProject && this.state.currentProject.id === id) {
                    this.resetChat();
                } else {
                    this.renderProjects();
                }
            },

            loadProject(id) {
                const project = this.state.projects.find(p => p.id === id);
                if (!project) return;

                this.state.currentProject = project;
                this.updatePreview(project.code);
                this.renderProjects();
                
                // On mobile, close sidebar after selection
                if(window.innerWidth < 768) {
                    const sidebar = document.getElementById('sidebar');
                    if(sidebar.classList.contains('sidebar-open')) this.toggleSidebar();
                }
            },

            renderProjects() {
                const list = document.getElementById('project-list');
                list.innerHTML = "";
                
                if (this.state.projects.length === 0) {
                    list.innerHTML = `<div class="text-center text-slate-500 py-4 text-xs">No projects yet</div>`;
                    return;
                }

                this.state.projects.forEach(p => {
                    const isActive = this.state.currentProject && this.state.currentProject.id === p.id;
                    const div = document.createElement('div');
                    
                    div.className = `group flex items-center justify-between p-3 rounded-lg cursor-pointer transition-all border border-transparent ${
                        isActive 
                        ? 'bg-blue-600/10 border-blue-600/30 text-white' 
                        : 'text-slate-400 hover:bg-white/5 hover:text-slate-200'
                    }`;
                    
                    div.onclick = () => this.loadProject(p.id);
                    
                    div.innerHTML = `
                        <div class="flex-1 min-w-0 pr-2">
                            <div class="font-medium truncate text-xs sm:text-sm">${p.name}</div>
                            <div class="text-[10px] opacity-50 mt-0.5">
                                ${new Date(p.updated).toLocaleDateString()}
                            </div>
                        </div>
                        <button onclick="app.deleteProject('${p.id}', event)" class="w-6 h-6 flex items-center justify-center rounded text-slate-500 hover:text-red-400 hover:bg-red-400/10 opacity-0 group-hover:opacity-100 transition-all">
                            <i class="fas fa-trash-alt text-xs"></i>
                        </button>
                    `;
                    list.appendChild(div);
                });
            },

            downloadCode() {
                const code = document.getElementById('code-editor').value;
                if(!code) return alert("Nothing to download!");
                
                const blob = new Blob([code], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `website-${Date.now()}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            },
            
            copyCode() {
                const code = document.getElementById('code-editor').value;
                if(!code) return;
                navigator.clipboard.writeText(code).then(() => {
                    const btn = document.querySelector('button[onclick="app.copyCode()"]');
                    const original = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-check"></i> Copied';
                    btn.classList.add('text-green-400');
                    setTimeout(() => {
                        btn.innerHTML = original;
                        btn.classList.remove('text-green-400');
                    }, 2000);
                });
            }
        };

        // Initialize
        window.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
